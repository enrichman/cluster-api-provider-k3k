---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  name: k3kcontrolplanes.controlplane.cluster.x-k8s.io
spec:
  group: controlplane.cluster.x-k8s.io
  names:
    kind: K3kControlPlane
    listKind: K3kControlPlaneList
    plural: k3kcontrolplanes
    singular: k3kcontrolplane
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: K3kControlPlane is the Schema for the K3kcontrolplanes API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: Spec is the desired spec of the K3k controlPlane.
            properties:
              addons:
                description: Addons is a list of secrets containing raw YAML which
                  will be deployed in the virtual K3k cluster on startup.
                items:
                  properties:
                    secretNamespace:
                      type: string
                    secretRef:
                      type: string
                  type: object
                type: array
              agentArgs:
                description: AgentArgs are the ordered key value pairs (e.x. "testArg",
                  "testValue") for the K3s pods running in agent mode.
                items:
                  type: string
                type: array
              agents:
                description: Agents is the number of K3s pods to run in agent (worker)
                  mode.
                format: int32
                type: integer
              clusterCIDR:
                description: ClusterCIDR is the CIDR range for the pods of the cluster.
                  Defaults to 10.42.0.0/16.
                type: string
              clusterDNS:
                description: |-
                  ClusterDNS is the IP address for the coredns service. Needs to be in the range provided by ServiceCIDR or CoreDNS may not deploy.
                  Defaults to 10.43.0.10.
                type: string
              expose:
                description: |-
                  Expose contains options for exposing the apiserver inside/outside of the cluster. By default, this is only exposed as a
                  clusterIP which is relatively secure, but difficult to access outside of the cluster.
                properties:
                  ingress:
                    properties:
                      enabled:
                        type: boolean
                      ingressClassName:
                        type: string
                    required:
                    - enabled
                    - ingressClassName
                    type: object
                  loadbalancer:
                    properties:
                      enabled:
                        type: boolean
                    required:
                    - enabled
                    type: object
                  nodePort:
                    properties:
                      enabled:
                        type: boolean
                    required:
                    - enabled
                    type: object
                required:
                - ingress
                - loadbalancer
                - nodePort
                type: object
              hostKubeconfig:
                description: |-
                  HostKubeconfig is the location of the kubeconfig to the host cluster that the K3k cluster should install in.
                  Optional, if not supplied the K3k cluster will be made in the current cluster.
                properties:
                  secretName:
                    description: SecretName is the name of the secret containing the
                      kubconfig data.
                    type: string
                  secretNamespace:
                    description: SecretNamespace is the namespace of the secret containing
                      the kubeconfig data.
                    type: string
                required:
                - secretName
                - secretNamespace
                type: object
              persistence:
                description: |-
                  Persistence contains options controlling how the etcd data of the virtual cluster is persisted. By default, no data
                  persistence is guaranteed, so restart of a virtual cluster pod may result in data loss without this field.
                properties:
                  storageClassName:
                    type: string
                  storageRequestSize:
                    type: string
                  type:
                    description: Type can be ephermal, static, dynamic
                    type: string
                required:
                - type
                type: object
              serverArgs:
                description: ServerArgs are the ordered key value pairs (e.x. "testArg",
                  "testValue") for the K3s pods running in server mode.
                items:
                  type: string
                type: array
              servers:
                description: Servers is the number of K3s pods to run in server (controlplane)
                  mode.
                format: int32
                type: integer
              serviceCIDR:
                description: ServiceCIDR is the CIDR range for the services in the
                  cluster. Defaults to 10.43.0.0/16.
                type: string
              tlsSANs:
                description: TLSSANs are the subjectAlternativeNames for the certificate
                  the K3s server will use.
                items:
                  type: string
                type: array
              token:
                description: Token is the token used to join the worker nodes to the
                  cluster.
                type: string
              version:
                description: Version is a string representing the Kubernetes version
                  to be used by the virtual nodes.
                type: string
            required:
            - agents
            - servers
            - token
            - version
            type: object
          status:
            description: Status is the current status of the K3k controlPlane.
            properties:
              clusterStatus:
                description: ClusterStatus is the status of the backing K3k cluster
                  type.
                properties:
                  clusterCIDR:
                    type: string
                  clusterDNS:
                    type: string
                  persistence:
                    properties:
                      storageClassName:
                        type: string
                      storageRequestSize:
                        type: string
                      type:
                        description: Type can be ephermal, static, dynamic
                        type: string
                    required:
                    - type
                    type: object
                  serviceCIDR:
                    type: string
                  tlsSANs:
                    items:
                      type: string
                    type: array
                type: object
              externalManagedControlPlane:
                description: |-
                  ExternalManagedControlPlane conforms to the upstream CAPI interface - true if node objects do not exist in the controlplane.
                  While K3k does have specific pods for the controlplane, these don't correspond to specific CAPI objects/machines, so in the
                  current state this will always be true.
                type: boolean
              initialized:
                description: Initialized conforms to the upstream CAPI interface -
                  true when the controlplane is contactable.
                type: boolean
              ready:
                description: Ready conforms to the upstream CAPI interface - true
                  when the target API Server is ready to receive requests.
                type: boolean
            required:
            - clusterStatus
            - externalManagedControlPlane
            - initialized
            - ready
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
